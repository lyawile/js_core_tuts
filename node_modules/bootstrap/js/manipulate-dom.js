let uniqueUsers, divContainer;

divContainer = document.querySelector('.main');
divContainer.addEventListener('click', e => {
    if (e.target.nodeName == 'A') {
        e.preventDefault()
        e.target.style.backgroundColor = '#0a2828'
        const nodes = Array.from(e.target.parentElement.parentElement.children);
        let  todoListNode;
        nodes.forEach(node=>{
            todoListNode = node;
        })
        const  todoDivClass  = todoListNode.getAttribute('class');
        if(todoDivClass == 'hide-me'){
            todoListNode.setAttribute('class','show-me');
        }else{
            todoListNode.setAttribute('class', 'hide-me')
        }
    }
})

let distinctUsers = new Array();
const request = new XMLHttpRequest;
request.open('GET', 'https://jsonplaceholder.typicode.com/todos/');

request.onload = () => {
    let users = JSON.parse(request.responseText), allTodosDetails = new Array();
    // showTodos(1, users);
    let userIds = new Array();
    users.forEach(user => {
        userIds.push(user.userId);
        allTodosDetails.push(user)
    })
    uniqueUsers = [...new Set(userIds)];
    uniqueUsers.forEach(userInfo => {
        divContainer.innerHTML += `<div class="test">
        User id: ${userInfo}
        <span class="action"><a href="#">TODOs</a></span>
        ${showTodos(userInfo, allTodosDetails)}
        </div>`;
    })

}
request.send();

function displayBadge(completed) {
    if (completed == true) {
        return `<span class="badge badge-success badge-pill">Completed</span>`
    } else {
        return `<span class="badge badge-danger badge-pill">Not completed</span>`
    }
}


function showTodos(userId, toDos) {
    let todos = new Array();
    let count = 1;
    let  data = "";
    toDos.forEach(toDoDetail => {
        if (toDoDetail.userId == userId) {
            todos.push(toDoDetail)
        }
    })

    return `<div class="hide-me">${
            todos.forEach(todo =>{
            data +=  `<p>${count} - ${todo.title} ${displayBadge(todo.completed)}</p>`;
            count++;
            })} 
            ${data}</div>`;
}
